<!DOCTYPE html>
<html lang="de" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Neo¬†Notes ‚Äì Login</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìù</text></svg>">

  <!-- Google Fonts & Material Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <style>
    :root {
      --bg-primary:#fff; --bg-secondary:#f8fafc; --bg-tertiary:#f1f5f9;
      --text-primary:#1e293b; --text-secondary:#64748b; --text-muted:#94a3b8;
      --border:#e2e8f0; --accent:#3b82f6; --accent-hover:#2563eb;
      --shadow-sm:0 1px 2px rgba(0,0,0,0.05);
      --shadow-md:0 4px 6px rgba(0,0,0,0.1),0 2px 4px rgba(0,0,0,0.1);
      --radius-sm:.375rem; --radius-md:.5rem; --radius-lg:.75rem; --radius-xl:1rem;
    }
    [data-theme="dark"] {
      --bg-primary:#0f172a; --bg-secondary:#1e293b; --bg-tertiary:#334155;
      --text-primary:#f8fafc; --text-secondary:#cbd5e1; --text-muted:#64748b;
      --border:#334155; --accent:#60a5fa; --accent-hover:#3b82f6;
      --shadow-sm:0 1px 2px rgba(0,0,0,0.3);
      --shadow-md:0 4px 6px rgba(0,0,0,0.3),0 2px 4px rgba(0,0,0,0.3);
    }
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
    body{font-family:'Inter',sans-serif;background:var(--bg-primary);color:var(--text-primary);height:100vh;overflow:hidden;}
    .hidden{display:none!important;}

    /* Onboarding Modal */
    .modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;
      background:rgba(0,0,0,0.5);backdrop-filter:blur(8px);z-index:50;}
    .modal-container{background:var(--bg-primary);border-radius:var(--radius-xl);
      padding:2rem;max-width:380px;width:90%;box-shadow:var(--shadow-md);border:1px solid var(--border);}
    .modal h2{text-align:center;margin-bottom:1rem;font-weight:600;}
    .form-switch-text{text-align:center;color:var(--text-secondary);margin-bottom:1.5rem;}
    .form-switch-text a{color:var(--accent);text-decoration:none;}
    .social-btns{display:flex;flex-direction:column;gap:0.75rem;margin-bottom:1rem;}
    .social-btn{display:flex;align-items:center;gap:0.5rem;padding:0.75rem;border:1px solid var(--border);
      border-radius:var(--radius-lg);background:var(--bg-primary);cursor:pointer;transition:all .2s;}
    .social-btn.google{color:#4285f4;border-color:#4285f4;}
    .social-btn.google:hover{background:#4285f4;color:#fff;}
    .separator{display:flex;align-items:center;margin:1.5rem 0;color:var(--text-muted);}
    .separator::before,.separator::after{content:"";flex:1;height:1px;background:var(--border);}
    .separator span{margin:0 0.5rem;}

    .auth-form{display:flex;flex-direction:column;gap:1rem;}
    .form-input{padding:0.75rem;border:1px solid var(--border);border-radius:var(--radius-md);
      background:var(--bg-secondary);color:var(--text-primary);}
    .form-input:focus{outline:none;border-color:var(--accent);}
    .pwd-wrapper{position:relative;}
    .pwd-toggle{position:absolute;top:50%;right:0.75rem;transform:translateY(-50%);
      background:none;border:none;color:var(--accent);cursor:pointer;}
    .forgot-link{text-align:right;color:var(--accent);font-size:0.875rem;}

    .primary-btn{padding:0.75rem;background:var(--accent);color:#fff;border:none;
      border-radius:var(--radius-md);cursor:pointer;font-weight:600;}
    .primary-btn:disabled{opacity:0.6;cursor:not-allowed;}

    .theme-toggle{position:absolute;bottom:1rem;left:1rem;width:40px;height:40px;
      border-radius:50%;background:var(--bg-secondary);border:1px solid var(--border);
      display:flex;align-items:center;justify-content:center;cursor:pointer;}

    /* Main Screen */
    .main-screen{height:100vh;display:flex;flex-direction:column;align-items:center;
      justify-content:center;text-align:center;padding:2rem;background:var(--bg-tertiary);}
    .main-screen h1{font-size:1.75rem;margin-bottom:1rem;color:var(--text-primary);}
    .main-screen p{color:var(--text-secondary);margin-bottom:2rem;}
    .main-screen .btn-group{display:flex;flex-direction:column;gap:0.75rem;width:100%;max-width:280px;}
    .main-screen .btn{padding:0.75rem;background:var(--accent);color:#fff;border:none;
      border-radius:var(--radius-md);cursor:pointer;font-weight:500;transition:all .2s;}
    .main-screen .btn:hover{background:var(--accent-hover);}
    .main-screen .secondary{background:var(--bg-secondary);color:var(--text-primary);border:1px solid var(--border);}
    .main-screen .secondary:hover{background:var(--bg-primary);}
  </style>
</head>
<body>

  <!-- Onboarding Modal -->
  <div id="onboarding" class="modal">
    <div class="modal-container">
      <h2 id="formTitle">Anmelden</h2>
      <p class="form-switch-text" id="formSwitchText">Noch kein Konto? <a href="#" id="toggleSignup">Registrieren</a></p>
      <div class="social-btns">
        <button class="social-btn google" id="googleLogin">
          <span class="material-icons">google</span> Mit Google anmelden
        </button>
      </div>
      <div class="separator"><span>ODER</span></div>
      <form id="authForm" class="auth-form">
        <input type="email" id="email" class="form-input" placeholder="E‚ÄëMail" required>
        <div class="pwd-wrapper">
          <input type="password" id="password" class="form-input" placeholder="Passwort" required>
          <button type="button" class="pwd-toggle" id="togglePassword">Anzeigen</button>
        </div>
        <a href="#" class="forgot-link" id="forgotPassword">Passwort vergessen?</a>
        <button type="submit" class="primary-btn" id="submitBtn">Anmelden</button>
      </form>
      <button class="theme-toggle" id="themeToggle">üåô</button>
    </div>
  </div>

  <!-- Main Screen -->
  <div id="mainScreen" class="main-screen hidden">
    <h1>Erfolgreich eingeloggt!</h1>
    <p>Du bist jetzt angemeldet als <span id="userEmail"></span>.</p>
    <div class="btn-group">
      <button class="btn" onclick="signOutUser()">Ausloggen</button>
      <button class="btn secondary" onclick="showEmailChange()">E‚ÄëMail √§ndern</button>
      <button class="btn secondary" onclick="showPasswordChange()">Passwort √§ndern</button>
    </div>
    <div id="emailChange" class="btn-group hidden" style="margin-top:1.5rem;">
      <input type="email" id="newEmail" class="form-input" placeholder="Neue E‚ÄëMail">
      <button class="btn" onclick="changeEmail()">E‚ÄëMail speichern</button>
    </div>
    <div id="pwChange" class="btn-group hidden" style="margin-top:1.5rem;">
      <input type="password" id="newPassword" class="form-input" placeholder="Neues Passwort">
      <button class="btn" onclick="changePassword()">Passwort speichern</button>
    </div>
  </div>

  <!-- Firebase & App Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import {
      getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword,
      signInWithPopup, GoogleAuthProvider,
      onAuthStateChanged, sendPasswordResetEmail, signOut,
      updateEmail, updatePassword
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import {
      getFirestore, enableIndexedDbPersistence
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // Deine Firebase‚ÄëConfig
    const firebaseConfig = {
      apiKey: "AIzaSyD8YAkuX6ZlcAEr-5peb_D8fclnsM4Y11o",
      authDomain: "neodev-notes.firebaseapp.com",
      projectId: "neodev-notes",
      storageBucket: "neodev-notes.firebasestorage.app",
      messagingSenderId: "271163999689",
      appId: "1:271163999689:web:4e7f1fb206bee80702d418",
      measurementId: "G-92MHTP7HMB"
    };
    initializeApp(firebaseConfig);
    const auth = getAuth();
    enableIndexedDbPersistence(getFirestore()).catch(e=>console.warn(e.code));

    // UI‚ÄëRefs
    const onboarding   = document.getElementById('onboarding');
    const mainScreen   = document.getElementById('mainScreen');
    const emailLabel   = document.getElementById('userEmail');
    const emailChange  = document.getElementById('emailChange');
    const pwChange     = document.getElementById('pwChange');

    // Login‚ÄëState
    onAuthStateChanged(auth, user => {
      if (user) {
        onboarding.classList.add('hidden');
        mainScreen.classList.remove('hidden');
        emailLabel.textContent = user.email;
      } else {
        onboarding.classList.remove('hidden');
        mainScreen.classList.add('hidden');
      }
    });

    // Events
    document.getElementById('toggleSignup').onclick = toggleSignup;
    document.getElementById('googleLogin').onclick   = signInWithGoogle;
    document.getElementById('authForm') .onsubmit    = handleAuth;
    document.getElementById('forgotPassword').onclick= forgotPassword;
    document.getElementById('togglePassword') .onclick=togglePassword;
    document.getElementById('themeToggle')  .onclick = toggleTheme;

    // Auth‚ÄëFlows
    async function handleAuth(e){
      e.preventDefault();
      const email = e.target.email.value.trim();
      const pw    = e.target.password.value;
      if (!email || !pw) { alert('Bitte Felder ausf√ºllen'); return; }
      const btn = document.getElementById('submitBtn');
      btn.disabled = true;
      const orig = btn.textContent; btn.textContent = '‚Ä¶';
      try {
        if (isSignup) await createUserWithEmailAndPassword(auth,email,pw);
        else          await signInWithEmailAndPassword(auth,email,pw);
      } catch(err) {
        alert(err.message);
      } finally {
        btn.disabled = false; btn.textContent = orig;
      }
    }
    function toggleSignup(){
      isSignup = !isSignup;
      document.getElementById('formTitle').textContent = isSignup ? 'Registrieren' : 'Anmelden';
      document.getElementById('submitBtn').textContent = isSignup ? 'Registrieren' : 'Anmelden';
      document.getElementById('formSwitchText').innerHTML = isSignup
        ? 'Bereits ein Konto? <a href="#" id="toggleSignup">Anmelden</a>'
        : 'Noch kein Konto? <a href="#" id="toggleSignup">Registrieren</a>';
      document.getElementById('toggleSignup').onclick = toggleSignup;
    }
    function signInWithGoogle(){
      const p = new GoogleAuthProvider();
      p.addScope('email'); p.addScope('profile');
      signInWithPopup(auth,p).catch(e=>alert(e.message));
    }
    function forgotPassword(e){
      e.preventDefault();
      const email = document.getElementById('email').value.trim();
      if (!email){ alert('E‚ÄëMail fehlt'); return; }
      sendPasswordResetEmail(auth,email).then(()=>alert('Reset‚ÄëMail gesendet'));
    }
    function signOutUser(){ signOut(auth); }

    // E‚ÄëMail/Passwort √§ndern
    function showEmailChange(){
      pwChange.classList.add('hidden');
      emailChange.classList.toggle('hidden');
    }
    async function changeEmail(){
      const newEmail = document.getElementById('newEmail').value.trim();
      if (!newEmail){ alert('Neue E‚ÄëMail eingeben'); return; }
      try {
        await updateEmail(auth.currentUser,newEmail);
        alert('E‚ÄëMail aktualisiert');
        document.getElementById('userEmail').textContent = newEmail;
        emailChange.classList.add('hidden');
      } catch(err) {
        alert('Fehler: '+err.message);
      }
    }
    function showPasswordChange(){
      emailChange.classList.add('hidden');
      pwChange.classList.toggle('hidden');
    }
    async function changePassword(){
      const newPw = document.getElementById('newPassword').value;
      if (!newPw){ alert('Neues Passwort eingeben'); return; }
      try {
        await updatePassword(auth.currentUser,newPw);
        alert('Passwort ge√§ndert');
        pwChange.classList.add('hidden');
      } catch(err) {
        alert('Fehler: '+err.message);
      }
    }

    // Passwort‚ÄëToggle & Theme
    function togglePassword(){
      const pw = document.getElementById('password');
      const btn= document.getElementById('togglePassword');
      if (pw.type==='password'){ pw.type='text'; btn.textContent='Verbergen'; }
      else { pw.type='password'; btn.textContent='Anzeigen'; }
    }
    function toggleTheme(){
      const html = document.documentElement;
      const next = html.dataset.theme==='light'?'dark':'light';
      html.dataset.theme = next;
      localStorage.setItem('theme',next);
    }

    // Init
    let isSignup = false;
    initTheme();
  </script>
</body>
</html>
